<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SweetBiscuit44 Calculator</title>
  <style>
    :root {
      --biscuit: #f9d8a6;
      --biscuit-dark: #e8c28d;
      --choco-chip: #5d4037;
      --warm-cream: #fdf5e6;
      --error: #e74c3c;
      --sound-on: #3498db;
      --sound-off: #95a5a6;
      --bg: #ffffff;
      --muted: #7a6a5f;
      --glass: rgba(255,255,255,0.6);
    }
    [data-theme="dark"] {
      --biscuit: #3e2e28;
      --biscuit-dark: #35221a;
      --choco-chip: #f6e9da;
      --warm-cream: #1b1a1a;
      --bg: #0f0f10;
      --muted: #bdb3a7;
      --glass: rgba(0,0,0,0.4);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial; }
    html,body { height:100%; }
    body {
      background: linear-gradient(180deg,var(--warm-cream),var(--bg));
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      transition: background .3s ease;
    }
    .splash {
      position: fixed; inset:0; display:flex; align-items:center; justify-content:center; background:var(--bg); z-index:9999; transition:opacity .45s ease, visibility .45s ease; 
    }
    .splash.hidden { opacity:0; visibility:hidden; }
    .splash .logo-wrap { text-align:center; }
    .splash svg { width:120px; height:120px; transform:scale(0.9); animation:pop .8s ease; }
    .splash p { margin-top:12px; color:var(--muted); font-weight:600; }
    @keyframes pop { 0% { transform: scale(.7) rotate(-6deg); opacity:0 } 60% { transform: scale(1.03); opacity:1 } 100% { transform: scale(1); } }
    .calculator {
      background: linear-gradient(180deg, var(--glass), rgba(255,255,255,0.02));
      backdrop-filter: blur(6px);
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.18);
      width: 100%;
      max-width: 420px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transform: translateY(10px);
      animation: fadeInUp .5s ease both;
    }
    @keyframes fadeInUp { from { opacity:0; transform: translateY(18px);} to { opacity:1; transform: translateY(0);} }
    .header {
      display:flex; align-items:center; gap:12px; padding:14px 18px; background:transparent;
    }
    .brand { display:flex; align-items:center; gap:12px; text-decoration:none; color:var(--choco-chip); }
    .cookie { width:56px; height:56px; border-radius:50%; background: radial-gradient(circle at 30% 30%, #ffdca8, #f2b57b); box-shadow: inset -6px -6px 18px rgba(0,0,0,0.06); display:flex; align-items:center; justify-content:center; }
    .cookie svg { width:34px; height:34px; }
    .brand h1 { font-size:1rem; margin:0; line-height:1; }
    .brand p { font-size:0.72rem; color:var(--muted); margin:0; }
    .display {
      background: linear-gradient(90deg, var(--biscuit), var(--biscuit-dark));
      color: var(--choco-chip);
      padding: 20px;
      text-align: right;
      font-size: 2rem;
      font-weight: 700;
      min-height: 84px;
      word-wrap: break-word;
      white-space: pre-wrap;
      display:flex; align-items:center; justify-content:flex-end; gap:8px;
    }
    .subrow { display:flex; align-items:center; gap:8px; font-size:0.8rem; color:var(--muted); }
    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      padding: 18px;
    }
    button {
      border: none;
      padding: 16px 10px;
      font-size: 1.17rem;
      border-radius: 12px;
      cursor: pointer;
      background: var(--biscuit);
      color: var(--choco-chip);
      font-weight: 700;
      transition: transform .12s ease, box-shadow .12s ease, background .15s ease;
      box-shadow: 0 6px 12px rgba(0,0,0,0.06);
    }
    button:active { transform: translateY(2px) scale(.99); }
    button:hover { transform: translateY(-4px); box-shadow: 0 12px 18px rgba(0,0,0,0.08); }
    .operator { background: linear-gradient(180deg,#d7b89a,#c69c80); }
    .equals { background: linear-gradient(180deg,#b8866b,#a86b4f); color: white; box-shadow: 0 10px 18px rgba(168,107,79,0.28); }
    .clear  { background: linear-gradient(180deg,var(--error),#c0392b); color: white; }
    .reset  { background: linear-gradient(180deg,#8e44ad,#6f2e96); color:white; grid-column: span 4; }
    .util-row { display:flex; gap:8px; padding: 0 18px 12px; align-items:center; }
    .util-row button, .util-row .small { padding:8px 10px; font-size:0.97rem; border-radius:10px; }
    .small { background:transparent; border:1px solid rgba(0,0,0,0.04); color:var(--muted); }
    .footer {
      background: transparent;
      padding: 12px 18px 18px;
      font-size: 0.99rem;
      color: var(--choco-chip);
      display: flex;
      flex-direction: row;
      gap: 8px;
      align-items: center;
      justify-content: space-between;
    }
    .footer .left { display:flex; gap:10px; align-items:center; flex-wrap: wrap; }
    .footer a { color: var(--choco-chip); font-weight:700; text-decoration:none; }
    .donate-btn { background: var(--choco-chip); color: white; padding: 8px 14px; border-radius: 10px; font-size: 0.97rem; text-decoration: none; }
    .history-panel { max-height:160px; overflow:auto; padding:8px 18px 18px; display:none; gap:8px; flex-direction:column; }
    .history-panel.show { display:flex; }
    .history-item { padding:8px 10px; border-radius:8px; background:rgba(0,0,0,0.03); color:var(--muted); font-weight:600; display:flex; justify-content:space-between; }
    /* responsive tweaks */
    @media (max-width: 500px) {
      .calculator { max-width:98vw; }
      .display { font-size:1.32rem; padding:14px; min-height:64px;}
      button { padding:12px 2px; font-size:1.01rem; }
      .cookie { width:38px; height:38px; }
      .header { padding:10px 6vw 8px 3vw; }
      .buttons { padding: 12px 4px; gap: 7px; }
      .footer { padding:10px 4vw 14px 3vw; font-size: .94em; flex-direction: column; gap: 6px; }
      .util-row{padding:0 3vw 10px 3vw;}
    }
    @media (max-width:346px){
      .display {font-size:1.07rem; padding:8px; min-height:44px;}
      button {font-size:0.97rem;}
      .footer {font-size: .89em;}
      .brand h1 {font-size:0.79rem;}
    }
  </style>
</head>
<body data-theme="light">

  <!-- SPLASH -->
  <div class="splash" id="splash">
    <div class="logo-wrap">
      <div class="cookie">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10" fill="#f6c27b"/><circle cx="8.5" cy="9" r="1.2" fill="#8a5a3a"/><circle cx="13" cy="14" r="1.4" fill="#8a5a3a"/><circle cx="15.5" cy="10.5" r="0.9" fill="#8a5a3a"/></svg>
      </div>
      <p>SweetBiscuit44 ‚Äî Loading‚Ä¶</p>
    </div>
  </div>

  <div class="calculator" id="app">

    <div class="header">
      <a class="brand" href="https://sweetbiscuit44-del.github.io/sweet-biscuit44-home-page/" target="_blank">
        <div class="cookie" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10" fill="#f6c27b"/><circle cx="8.5" cy="9" r="1.2" fill="#8a5a3a"/><circle cx="13" cy="14" r="1.4" fill="#8a5a3a"/><circle cx="15.5" cy="10.5" r="0.9" fill="#8a5a3a"/></svg>
        </div>
        <div>
          <h1>SweetBiscuit44 Calculator</h1>
          <p>cozy cookie-themed math</p>
        </div>
      </a>
      <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
        <button id="theme-toggle" class="small">üåô</button>
        <button id="history-toggle" class="small">üìú</button>
      </div>
    </div>

    <div class="display" id="display">0</div>

    <div class="util-row">
      <button id="copy-btn" class="small">Copy</button>
      <button id="paste-btn" class="small">Paste</button>
      <button id="clear-storage" class="small">Clear Storage</button>
      <div style="flex:1"></div>
      <div class="subrow">Saved: <span id="saved-indicator">‚Äî</span></div>
    </div>

    <div class="buttons" id="button-grid">
      <button class="clear">C</button>
      <button class="operator">‚å´</button>
      <button class="operator">√∑</button>
      <button class="operator">√ó</button>

      <button>7</button>
      <button>8</button>
      <button>9</button>
      <button class="operator">‚àí</button>

      <button>4</button>
      <button>5</button>
      <button>6</button>
      <button class="operator">+</button>

      <button>1</button>
      <button>2</button>
      <button>3</button>
      <button class="equals">=</button>

      <button style="grid-column: span 2;">0</button>
      <button>.</button>
      <button class="operator">%</button>

      <button class="reset">Reset Calculator</button>
    </div>

    <div class="history-panel" id="history-panel"></div>

    <div class="footer">
      <div class="left">
        <a class="donate-btn" href="https://paypal.me/sweetbiscuit44" target="_blank">üíõ Donate</a>
        <a href="mailto:sweetbiscuit44@gmail.com">üìß Email</a>
        <a href="https://sweetbiscuit44-del.github.io/sweet-biscuit44-home-page/" target="_blank">üç™ SweetBiscuit Main</a>
      </div>
      <div style="display:flex; gap:8px; align-items:center;">
        <button id="sound-toggle">üéµ</button>
      </div>
    </div>

  </div>

  <script>
    // ---- state and persistence ----
    const STORAGE_KEY = 'sb_calc_state_v2';
    let state = {
      input: '0',
      history: [],
      sound: true,
      theme: 'light'
    };

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw){ Object.assign(state, JSON.parse(raw)); }
      }catch(e){ console.warn('loadState failed',e); }
    }
    function saveState(){
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); document.getElementById('saved-indicator').textContent = new Date().toLocaleTimeString(); }catch(e){}
    }

    loadState();

    // ---- DOM refs ----
    const display = document.getElementById('display');
    const btnGrid = document.getElementById('button-grid');
    const historyPanel = document.getElementById('history-panel');
    const splash = document.getElementById('splash');

    // ---- audio ----
    let audioCtx = null;
    let isAudioUnlocked = false;
    function initAudio(){
      if(isAudioUnlocked || !state.sound) return;
      try{ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); isAudioUnlocked=true; }catch(e){}
    }
    function playTick(){ if(!state.sound || !isAudioUnlocked || !audioCtx) return; const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.type='sine'; o.frequency.value=680; g.gain.value=0.03; o.start(); g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+0.08); o.stop(audioCtx.currentTime+0.09); }

    // ---- init UI from state ----
    let currentInput = state.input || '0';
    let theme = state.theme || 'light';
    document.body.setAttribute('data-theme', theme);
    updateDisplay();

    // show splash then hide
    window.addEventListener('load', ()=>{
      setTimeout(()=>{ splash.classList.add('hidden'); }, 700);
    });

    // ---- display logic ----
    function updateDisplay(){
      display.textContent = currentInput.length > 18 ? currentInput.substring(0,18)+'‚Ä¶' : currentInput;
      state.input = currentInput; saveState(); renderHistory();
    }

    function appendToDisplay(value){ initAudio(); playTick();
      if(value === '‚å´'){ currentInput = currentInput.length>1 ? currentInput.slice(0,-1) : '0'; }
      else if(currentInput==='0' && value !== '.') currentInput = value;
      else{ const last = currentInput.slice(-1); const ops=['+','-','*','/','%']; if(ops.includes(value) && ops.includes(last)){ currentInput = currentInput.slice(0,-1) + value; } else { currentInput += value; } }
      updateDisplay();
    }

    function clearDisplay(){ initAudio(); playTick(); currentInput='0'; updateDisplay(); }

    function resetCalculator(){ localStorage.removeItem(STORAGE_KEY); state = { input:'0', history:[], sound: state.sound, theme: state.theme }; currentInput='0'; saveState(); updateDisplay(); }

    function calculate(){ initAudio(); playTick(); try{ let expr = currentInput.replace(/√ó/g,'*').replace(/√∑/g,'/').replace(/‚àí/g,'-'); let result = Function('"use strict"; return ('+expr+')')(); state.history.unshift({ in: currentInput, out: String(result), at: Date.now() }); if(state.history.length>50) state.history.pop(); currentInput = String(result); updateDisplay(); }catch(e){ currentInput='Error'; updateDisplay(); setTimeout(clearDisplay,1500); } }

    // ---- history UI ----
    function renderHistory(){ historyPanel.innerHTML = ''; if(!state.history || state.history.length===0) return; historyPanel.classList.add('show'); state.history.forEach((h,i)=>{ const div=document.createElement('div'); div.className='history-item'; div.innerHTML = `<div>${h.in} = ${h.out}</div><div><button data-index="${i}" class="small">Use</button></div>`; historyPanel.appendChild(div); }); }

    // use history item
    historyPanel.addEventListener('click', e => { if(e.target.tagName==='BUTTON'){ const idx = Number(e.target.dataset.index); const item = state.history[idx]; if(item){ currentInput = item.out; updateDisplay(); } } });

    // ---- events ----
    btnGrid.addEventListener('click', e => { if(e.target.tagName!=='BUTTON') return; const text = e.target.textContent; if(text==='C') clearDisplay(); else if(text==='Reset Calculator') resetCalculator(); else if(text==='‚å´') appendToDisplay('‚å´'); else if(text==='=') calculate(); else if(text==='√∑') appendToDisplay('/'); else if(text==='√ó') appendToDisplay('*'); else if(text==='‚àí') appendToDisplay('-'); else appendToDisplay(text); });

    document.addEventListener('keydown', e => { if(e.key==='Enter') calculate(); else if(e.key==='Escape') clearDisplay(); else if(e.key==='Backspace'){ e.preventDefault(); appendToDisplay('‚å´'); } else if(/^[0-9]$/.test(e.key)) appendToDisplay(e.key); else if(e.key==='.') appendToDisplay('.'); else if(['+','-','*','/','%'].includes(e.key)) appendToDisplay(e.key); });

    // copy / paste
    document.getElementById('copy-btn').addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(currentInput); alert('Copied: '+currentInput); }catch(e){ alert('Copy failed'); } });
    document.getElementById('paste-btn').addEventListener('click', async ()=>{ try{ const txt = await navigator.clipboard.readText(); if(txt) { currentInput = txt; updateDisplay(); } }catch(e){ alert('Paste failed'); } });

    document.getElementById('clear-storage').addEventListener('click', ()=>{ if(confirm('Clear saved calculator data (history & input)?')){ localStorage.removeItem(STORAGE_KEY); state.history=[]; currentInput='0'; saveState(); updateDisplay(); } });

    // theme toggle
    document.getElementById('theme-toggle').addEventListener('click', ()=>{ state.theme = state.theme==='dark'?'light':'dark'; document.body.setAttribute('data-theme', state.theme); saveState(); });

    // history toggle
    document.getElementById('history-toggle').addEventListener('click', ()=>{ historyPanel.classList.toggle('show'); });

    // sound toggle
    const soundBtn = document.getElementById('sound-toggle');
    function loadSound(){ state.sound = state.sound !== false; soundBtn.classList.toggle('active', state.sound); }
    function toggleSound(){ state.sound = !state.sound; soundBtn.classList.toggle('active', state.sound); saveState(); }
    soundBtn.addEventListener('click', ()=>{ toggleSound(); initAudio(); });
    loadSound();

    // restore history on load
    renderHistory();

    // set currentInput from state
    currentInput = state.input || '0'; updateDisplay();

  </script>
</body>
</html>

