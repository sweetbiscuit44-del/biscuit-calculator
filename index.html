<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
  <title>SweetBiscuit44 Calculator — Glazed Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    /* 1. Variables and Reset */
    :root {
      --color-primary: #f9d8a6; /* Biscuit */
      --color-primary-dark: #e8c28d; 
      --color-accent: #5d4037; /* Choco Chip */
      --color-background: #fdf5e6; /* Warm Cream */
      --color-text: var(--color-accent);
      --color-util: #d7b89a; 
      --color-equals: #9f6a4f;
      --color-clear: #e74c3c;
      --color-reset: #8e44ad;
      --color-muted: #7a6a5f;
      --glass-light: rgba(255, 253, 245, 0.85);
      --glass-dark: rgba(15, 15, 16, 0.75);
      --shadow-primary: 0 10px 30px rgba(93, 64, 55, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.5);
      --shadow-button: 0 4px 8px rgba(0, 0, 0, 0.08);
      --border-radius-main: 28px;
      --border-radius-button: 16px;
      --font-display: 'Nunito', monospace;
      --font-body: 'Quicksand', system-ui, sans-serif;
    }
    [data-theme="dark"] {
      --color-primary: #3e2e28;
      --color-primary-dark: #35221a;
      --color-accent: #f6e9da;
      --color-background: #0f0f10;
      --color-text: var(--color-accent);
      --color-util: #281d18;
      --color-equals: #7b4f3b;
      --color-clear: #c0392b;
      --color-reset: #6c3483;
      --color-muted: #bdb3a7;
      --glass-light: rgba(15, 15, 16, 0.65);
      --shadow-primary: 0 10px 30px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
      --shadow-button: 0 4px 8px rgba(0, 0, 0, 0.4);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    /* 2. Body and Background */
    body, html {
      width: 100%;
      height: 100%;
      overflow-x: hidden;
      font-family: var(--font-body);
      color: var(--color-text);
      background: var(--color-background);
      transition: background 0.3s, color 0.3s;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    /* Simple, subtle texture background for better contrast in dark mode */
    body {
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(249, 216, 166, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(232, 194, 141, 0.1) 0%, transparent 25%),
        var(--color-background);
    }

    /* 3. Calculator Structure (Glassmorphism) */
    .calculator {
      width: 100%;
      max-width: 420px; /* Slightly narrower, modern feel */
      border-radius: var(--border-radius-main);
      background: var(--glass-light);
      backdrop-filter: blur(20px) saturate(150%); /* Increased blur */
      -webkit-backdrop-filter: blur(20px) saturate(150%);
      box-shadow: var(--shadow-primary);
      overflow: hidden;
      z-index: 2;
      border: 1px solid rgba(232, 194, 141, 0.3);
      display: flex;
      flex-direction: column;
    }

    /* 4. Display Area */
    .display-container {
      padding: 24px 22px 12px;
      text-align: right;
      background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
      box-shadow: inset 0 -4px 10px rgba(0,0,0,0.1);
    }
    .history {
      color: rgba(93, 64, 55, 0.6);
      font-size: 1rem;
      font-family: var(--font-display);
      min-height: 20px;
      white-space: nowrap;
      overflow-x: auto;
      margin-bottom: 5px;
    }
    .display {
      font-size: 2.8rem; /* Larger font */
      font-family: var(--font-display);
      min-height: 50px;
      color: var(--color-accent);
      text-shadow: 0 1px 1px rgba(255,255,255,0.4);
      letter-spacing: -1px;
      overflow-x: auto;
      white-space: nowrap;
    }
    
    /* 5. Utility and Main Buttons */
    .util-row, .buttons {
      padding: 16px 18px;
      gap: 10px;
    }
    .util-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      padding-top: 10px;
      padding-bottom: 0;
    }
    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      padding-top: 14px;
    }
    
    button {
      padding: 18px 0;
      font-size: 1.25rem;
      font-weight: 600;
      border: none;
      border-radius: var(--border-radius-button);
      cursor: pointer;
      background: var(--color-primary);
      color: var(--color-text);
      transition: all 0.15s ease-out;
      box-shadow: var(--shadow-button);
      font-family: var(--font-body);
      /* Glazed effect on hover/active */
      position: relative;
      overflow: hidden;
    }
    button::after {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: radial-gradient(circle at center, rgba(255,255,255,0.4), transparent 70%);
      opacity: 0;
      transition: opacity 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 10px rgba(0,0,0,0.15);
      background: var(--color-primary-dark);
    }
    button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button:hover::after { opacity: 1; }
    
    /* Utility Buttons */
    .util-row button {
      font-size: 0.95rem;
      padding: 10px 14px;
      border-radius: 12px;
      background: var(--color-util);
      color: var(--color-accent);
    }

    /* Special Buttons */
    .operator { 
      background: var(--color-util); 
      color: var(--color-accent);
    }
    .clear-btn { 
      background: linear-gradient(135deg, var(--color-clear), #a83528); 
      color: white;
      font-weight: 700;
    }
    .back-btn {
      background: linear-gradient(135deg, #ffe3b2, #d3ba8b);
      color: #ad6630;
      font-weight: 700;
    }
    .equals { 
      background: linear-gradient(135deg, #b9866b, var(--color-equals)); 
      color: white; 
      font-weight: 700;
    }
    .reset { 
      grid-column: span 4; 
      background: linear-gradient(135deg, var(--color-reset), #6c3483); 
      color: white; 
      font-weight: 700; 
      letter-spacing: 1px;
    }
    /* Span 2 for zero */
    .zero {
        grid-column: span 2;
    }

    /* Sound Toggle */
    #sound-toggle.active {
      background: #3498db; /* Sound On Blue */
      color: #fff;
    }
    
    /* 6. Footer and Theme Toggle */
    .footer {
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 0.9rem;
      font-family: var(--font-body);
      color: var(--color-muted);
      background: rgba(253, 245, 230, 0.3);
      border-top: 1px solid rgba(232, 194, 141, 0.3);
      align-items: center;
    }
    .footer a, .theme-toggle {
      text-decoration: none;
      color: var(--color-text);
      display: flex;
      align-items: center;
      gap: 4px;
      transition: color 0.2s;
    }
    .footer a:hover, .theme-toggle:hover {
      color: var(--color-primary-dark);
      text-decoration: underline;
    }
    .theme-toggle {
      cursor: pointer;
      font-size: 1.1rem;
    }

    /* 7. Media Queries */
    @media (max-width: 480px) {
      .calculator { max-width: 95vw; border-radius: 20px;}
      .display { font-size: 2rem; }
      .buttons { padding: 10px; gap: 8px; }
      button { font-size: 1.1rem; padding: 14px 0; border-radius: 12px;}
    }
    @media (max-width: 380px) {
      .display { font-size: 1.6rem; }
      .history { font-size: 0.8rem; }
      button { font-size: 1rem; padding: 12px 0; }
    }
  </style>
</head>
<body data-theme="light">

<div class="calculator">
  <div class="display-container">
    <div class="history" id="history"></div>
    <div class="display" id="display">0</div>
  </div>

  <div class="util-row">
    <button id="copy"><i class="fas fa-clipboard"></i> Copy</button>
    <button id="paste"><i class="fas fa-paste"></i> Paste</button>
    <button id="clear-storage"><i class="fas fa-broom"></i> Clear Data</button>
    <button id="sound-toggle"><i class="fas fa-bell"></i> Sound</button>
  </div>

  <div class="buttons" id="button-grid">
    <button class="clear-btn" data-value="C">C</button>
    <button class="back-btn" data-value="backspace"><i class="fas fa-backspace"></i></button>
    <button class="operator" data-value="÷">÷</button>
    <button class="operator" data-value="×">×</button>

    <button data-value="7">7</button>
    <button data-value="8">8</button>
    <button data-value="9">9</button>
    <button class="operator" data-value="−">−</button>

    <button data-value="4">4</button>
    <button data-value="5">5</button>
    <button data-value="6">6</button>
    <button class="operator" data-value="+">+</button>

    <button data-value="1">1</button>
    <button data-value="2">2</button>
    <button data-value="3">3</button>
    <button class="equals" data-value="=">=</button>

    <button class="zero" data-value="0">0</button>
    <button data-value=".">.</button>
    <button class="operator" data-value="%">%</button>
    
    <button class="reset" data-value="reset"><i class="fas fa-magic"></i> Reset Calculator</button>
  </div>

  <div class="footer">
    <a href="https://paypal.me/sweetbiscuit44" target="_blank"><i class="fas fa-heart"></i> Donate</a>
    <a href="mailto:sweetbiscuit44@gmail.com"><i class="fas fa-envelope"></i> Email</a>
    <a href="https://sweetbiscuit44-del.github.io/sweet-biscuit44-home-page/" target="_blank"><i class="fas fa-home"></i> Biscuit Home</a>
    <div id="theme-toggle" class="theme-toggle" role="button" aria-label="Toggle Dark Mode">
        <i class="fas fa-sun"></i> Theme
    </div>
  </div>
</div>

<audio id="ping" src="https://cdn.pixabay.com/audio/2022/08/20/audio_124b65cce3.mp3" preload="auto"></audio>

<script>
// --- Calculator State ---
let currentInput = localStorage.getItem('sb_input') || '0';
let historyLog = localStorage.getItem('sb_history') || '';
let soundOn = localStorage.getItem('sb_sound') !== 'off';
let theme = localStorage.getItem('sb_theme') || 'light';

// --- DOM Elements ---
const display = document.getElementById('display');
const historyDisplay = document.getElementById('history');
const soundBtn = document.getElementById('sound-toggle');
const themeToggle = document.getElementById('theme-toggle');
const buttonGrid = document.getElementById('button-grid');
const ping = document.getElementById('ping');

// --- Initialization and Utility Functions ---

/** Plays a button sound if sound is enabled. */
function playPing() {
  if (soundOn && ping) {
    ping.currentTime = 0;
    ping.play().catch(() => {}); // Avoids promise rejection error if user hasn't interacted yet
  }
}

/** Updates the display and saves state to Local Storage. */
function update() {
  // Use a display-friendly version of currentInput for the main display
  const displayValue = currentInput.length > 18 
    ? currentInput.slice(0, 18) + '…' 
    : currentInput;
  display.textContent = displayValue;
  historyDisplay.textContent = historyLog;
  
  localStorage.setItem('sb_input', currentInput);
  localStorage.setItem('sb_history', historyLog);
}

/** Toggles dark/light mode. */
function toggleTheme() {
  theme = theme === 'light' ? 'dark' : 'light';
  document.body.dataset.theme = theme;
  localStorage.setItem('sb_theme', theme);
  const icon = theme === 'dark' ? 'moon' : 'sun';
  themeToggle.innerHTML = `<i class="fas fa-${icon}"></i> Theme`;
}

// Initial setup
document.body.dataset.theme = theme;
soundBtn.classList.toggle('active', soundOn);
toggleTheme(); // Call once to set initial icon
toggleTheme(); // Call again to set initial theme, this is a trick to run the logic without duplicating

update(); // Load initial state

// --- Core Calculator Logic ---

/** Appends value to input, handling special cases. */
function append(v) {
  playPing();
  
  // Basic validation: prevent multiple operators or decimals at the end
  const lastChar = currentInput.slice(-1);
  const isOperator = (char) => ['÷', '×', '−', '+', '%'].includes(char);
  
  if (v === 'backspace') {
    currentInput = currentInput.length > 1 ? currentInput.slice(0, -1) : '0';
  } else if (currentInput === '0' && v !== '.') {
    currentInput = v;
  } else if (isOperator(v) && (isOperator(lastChar) || lastChar === '.')) {
    // Replace last operator/decimal with new operator
    currentInput = currentInput.slice(0, -1) + v;
  } else {
    currentInput += v;
  }
  update();
}

/** Executes the calculation. */
function calc() {
  playPing();
  try {
    // 1. Prepare expression for 'eval' (safely via Function constructor)
    let expr = currentInput
      .replace(/×/g, '*')
      .replace(/÷/g, '/')
      .replace(/−/g, '-')
      .replace(/%/g, '/100*'); // Handle percentage: 10% -> 10/100*
      
    // 2. Simple, strict input check (improved security slightly)
    if (!/^[0-9+\-*/%.() ]+$/.test(expr)) {
      throw new Error('Unsafe or invalid input sequence.');
    }
    
    // 3. Perform calculation
    const result = Function('"use strict"; return (' + expr + ')')();
    
    // 4. Handle results
    if (!isFinite(result)) {
      currentInput = 'Error: Math';
      historyLog = currentInput;
    } else {
      historyLog = currentInput + ' =';
      // Limit to 10 decimal places for better display/precision
      currentInput = String(Math.round(result * 10000000000) / 10000000000); 
    }
    
  } catch (e) {
    currentInput = 'Error';
  }
  
  update();
  // Clear error after a short delay
  if (currentInput.includes('Error')) {
    setTimeout(() => {
      currentInput = '0'; 
      historyLog = '';
      update();
    }, 1500);
  }
}

/** Resets current input only. */
function clearAll() { 
  playPing(); 
  currentInput = '0'; 
  historyLog = '';
  update(); 
}

/** Clears all storage and resets the calculator. */
function resetCalc() {
  playPing();
  localStorage.clear();
  currentInput = '0';
  historyLog = '';
  soundOn = true; // Reset sound to default
  soundBtn.classList.add('active');
  document.body.dataset.theme = 'light';
  update();
  alert("Calculator reset complete! All stored data cleared.");
}

// --- Event Handlers ---

// Delegate button clicks
buttonGrid.addEventListener('click', e => {
  if (e.target.tagName !== 'BUTTON') return;
  const value = e.target.dataset.value;
  
  if (value === 'C') clearAll();
  else if (value === 'reset') resetCalc();
  else if (value === '=') calc();
  else append(value);
});

// Sound Toggle
if (soundBtn) {
  soundBtn.addEventListener('click', () => {
    soundOn = !soundOn;
    localStorage.setItem('sb_sound', soundOn ? 'on' : 'off');
    soundBtn.classList.toggle('active', soundOn);
    playPing();
  });
}

// Theme Toggle
if (themeToggle) {
    themeToggle.addEventListener('click', toggleTheme);
}

// Copy
document.getElementById('copy').addEventListener('click', () => {
  playPing();
  navigator.clipboard.writeText(currentInput).then(() => {
    // Optionally show a "Copied!" message
  }).catch(() => {});
});

// Paste
document.getElementById('paste').addEventListener('click', () => {
  playPing();
  navigator.clipboard.readText().then(text => {
    const cleanText = text.trim();
    // Simple check to ensure pasted content is calculation-safe
    if (/^[0-9+\-*/%÷×.−]+$/.test(cleanText) && cleanText.length > 0) {
      currentInput = cleanText;
      update();
    }
  }).catch(() => {});
});

// Clear Storage button
document.getElementById('clear-storage').addEventListener('click', resetCalc);

// Keyboard Support (Bonus Feature)
document.addEventListener('keydown', e => {
    let key = e.key;

    // Map keyboard keys to calculator values
    const keyMap = {
        'Enter': '=',
        'Backspace': 'backspace',
        '/': '÷',
        '*': '×',
        '-': '−',
        'c': 'C',
        'C': 'C',
    };
    
    // Check if the key is a number, operator, or special mapped key
    let mappedValue = keyMap[key] || key;
    
    if (/[0-9]/.test(mappedValue) || ['.', '+', '%'].includes(mappedValue)) {
        e.preventDefault();
        append(mappedValue);
    } else if (['÷', '×', '−', 'backspace'].includes(mappedValue)) {
        e.preventDefault();
        append(mappedValue);
    } else if (mappedValue === 'C') {
        e.preventDefault();
        clearAll();
    } else if (mappedValue === '=') {
        e.preventDefault();
        calc();
    }
});
</script>

</body>
</html>
